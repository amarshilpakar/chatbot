var{assign:a}=Object;function b(aU,aV){chatbotToggler=void 0;closeBtn=void 0;chatBox=void 0;chatInput=void 0;sendChatBtn=void 0;userMessage=null;inputInitHeight=void 0}a(b.prototype,{init(){this.chatbotToggler=document.querySelector('.chat-bot-activate');this.closeBtn=document.querySelector('.close-btn');this.chatBox=document.querySelector('.chat-box');this.chatInput=document.querySelector('.chat-box-input textarea');this.sendChatBtn=document.getElementById('send-btn');;this.inputInitHeight=this.chatInput.scrollHeight;this.attachBtn=document.getElementById('attach_file');this.fileInput=document.getElementById('file-upload');this.imageExtension=['.jpg','.jpeg','.png'];this.chatInput.addEventListener('input',()=>{this.chatInput.style.height=`${this.inputInitHeight}px`;this.chatInput.style.height=`${this.chatInput.scrollHeight}px`});this.attachBtn.addEventListener('click',()=>this.fileInput.click());this.fileInput.addEventListener('change',e=>this.handleFileUpload(e));this.chatInput.addEventListener('keydown',e=>e.key=='Enter'&&!e.shiftKey&&window.innerWidth>800&&(e.preventDefault(),this.onChatInput()));var A=(_=>this.chatInput.value+=_);EmojiButton(document.querySelector('#emoji-button'),A.bind(this));this.sendChatBtn.addEventListener('click',this.onChatInput.bind(this));this.closeBtn.addEventListener('click',()=>document.body.classList.remove('display-chat'));this.chatbotToggler.addEventListener('click',()=>document.body.classList.toggle('display-chat'))},generateImagesDiv(B){if(B.length>0){var C=document.createElement('div');C.className='image-container outgoing';B.length>3&&(C.className+=' flex-box');currentIndex=0;for(const _a of B){if(currentIndex>2)break;var _c=document.createElement('img');_c.src=_a.blobUrl;_c.alt=_a.fileName;C.appendChild(_c);currentIndex++}if(B.length>3){var d=document.createElement('div'),E=document.createElement('span');d.innerText=B.length-3;E.innerText='Show More...';d.appendChild(document.createElement('span'));d.appendChild(E);C.appendChild(d)}this.chatBox.appendChild(C)}},generateDocumentDiv(D){if(!D.length)return;var _b=document.createElement('div');_b.className='file-attachment outgoing';for(const _A of D){var _C=document.createElement('div'),_d=document.createElement('div'),_e=document.createElement('span'),F=document.createElement('span'),g=document.createElement('span');_d.className='icon-file';_e.className='material-symbols-outlined';_e.innerText='attachment';F.innerText=_A.name;F.className='file-name';g.className='action';g.innerText='click here to see details';g.onclick=this.displayFile.bind(this,_A);_d.appendChild(_e);_d.appendChild(F);_C.appendChild(_d);_C.appendChild(g);_b.appendChild(_C)}this.chatBox.appendChild(_b)},fileReaderObservable(aA){var _B=new Promise(aB=>{const aC=URL.createObjectURL(aA);aB({image:aC,fileName:aA.name,file:aA})});return _B},handleFileUpload(aD){var aE=aD.target.files||aD.srcElement.files||aD.dataTransfer.files,aF=[];for(let i=0;i<aE.length;i++)aF.push(this.fileReaderObservable(aE[i]));if(!aF.length){this.fileInput.value=null;return}Promise.all(aF).then(aG=>{if(aG&&aG.length>0){var aH=[];for(const aI of aG)aH.push({'name':aI.fileName,'blobUrl':aI.image,'type':aI.fileName.substring(aI.fileName.lastIndexOf('.'),aI.fileName.length).toLowerCase()});this.generateAttachmentContent(aH)}})},generateAttachmentContent(aJ){var aK=document.createElement('div');aK.className='attachment-container';this.generateImagesDiv(aJ.filter(f=>this.imageExtension.includes(f.type)));this.generateDocumentDiv(aJ.filter(f=>!this.imageExtension.includes(f.type)))},displayFile({blobUrl:aL}){window.open(aL,'_blank')},generateChatContent(aM,aN){var aO=document.createElement('li');aO.classList.add('chat',`${aN}`);aO.innerHTML=aN=='outgoing'?`<p>${aM}</p>`:`<span class="material-symbols-outlined">smart_toy</span><p></p>`;return aO},callChatAPI(aP){var aQ=aP.querySelector('p');fetch('https://api.openai.com/v1/chat/completions',{method:'POST',headers:{'Content-Type':'application/json','Authorization':`Bearer ${this.API_KEY}`},body:JSON.stringify({model:'gpt-3.5-turbo',messages:[{role:'user',content:userMessage}]})}).then(aR=>aR.json()).then(aS=>aQ.textContent=aS.choices[0].message.content.trim()).catch(()=>{aQ.classList.add('error');aQ.textContent='Oops! Something went wrong. Please try again.'}).finally(()=>this.chatBox.scrollTo(0,this.chatBox.scrollHeight))},onChatInput(){this.userMessage=this.chatInput.value.trim();if(!this.userMessage)return;this.chatInput.value='';this.chatInput.style.height=`${this.inputInitHeight}px`;this.chatBox.appendChild(this.generateChatContent(this.userMessage,'outgoing'));this.chatBox.scrollTo(0,this.chatBox.scrollHeight);setTimeout(()=>{var aT=this.generateChatContent('Please wait...','incoming');this.chatBox.appendChild(aT);this.chatBox.scrollTo(0,this.chatBox.scrollHeight);this.callChatAPI(aT)},600)}});var c=new b('', '');window.addEventListener('DOMContentLoaded',()=>c.init());
